# 配置选项

本类型库有几个可选选项，位于本库的入口文件 `index.ts` 中的 `TypeOptions` 命名空间内。

你可以根据自己的需求、设备性能等，修改入口文件，改变本库的配置，得到更好的效果。

本文中“目前版本”指 TypeScript v4.8.4 版本到 v4.9.5 版本。

目录：

- [递归相关](#递归相关)
  - [最大迭代次数](#最大迭代次数)
  - [最大尾递归栈数](#最大尾递归栈数)
  - [单层栈空间内尾递归最大次数](#单层栈空间内尾递归最大次数)

## 递归相关

本项配置位于 `Iteration` 命名空间。

出于通用性考虑，本库的大部分递归类型可以迭代非常多次。
然而，有的时候迭代次数太多可能会导致编译缓慢，甚至出现爆内存、抛出未捕获错误等意外情况使编译器异常退出。
此时可以考虑修改本项配置。

### 最大迭代次数

了解本库的递归方法可以参考 [《TS 类型编程 终极优化》](https://www.cnblogs.com/QiFande/p/ts-super-recursion.html)。

其中提到的公式 $M=(S-L-1)P^L$ 可用来计算类型的最大迭代次数。

- $M$ 为最大迭代次数
- $S$ 为 TS 中尾递归的最大次数限制，目前版本中的 $S=1000$
- $L$ 可修改，为最大尾递归栈数
- $P$ 可修改，为单层栈空间内尾递归最大次数。范围大约为 $[1,S-L]$

考虑到大部分递归类型都是操作字符串类型或元组类型，迭代次数与其长度有密切关系，故理想状态是接近 $M \ge 10^9$ ，大概就超过了字符串类型最大长度。

但实际上由于设备性能原因，本人电脑上的试验指出：当 $M \ge 10^7$ 时，编辑器的智能感知可能就会出现明显的卡顿； $M \ge 10^8$ 时，智能感知就有很大概率无法成功启动。
等到 $M \ge 10^9$ 时，基本能闻到香气了。

还请根据设备实际性能对 $L$ 和 $P$ 进行修改。

### 最大尾递归栈数

$L$ 表示一个递归类型最多可以套几层尾递归。

对于 `Repeated` 等已知迭代次数的类型，实际使用的栈层数与本值相同；
而对于 `LenOfStr` 等不知道具体迭代数字的类型，本值只代表其最大使用的栈层数。

如果出现 `ts(2589)` 错误“类型实例化过深，且可能无限”，可适当增大此值。

### 单层栈空间内尾递归最大次数

$P$ 表示在每层栈内尾递归多少次之后收回栈空间。

与 $L$ 相似，如果出现 `ts(2589)` 错误，可适当增大此值。

但报错时，更推荐修改 $L$ 而非 $P$ 。
因为 $P$ 越小（当然也不能太小），像 `LenOfStr` 等类型对迭代次数的预测就越准确，性能就越好。
就像吃的更饱，既可以通过吃更大的馒头，也可以通过吃更多馒头。
但是更大的馒头就更难控制饭量，有可能出现吃一个饿得慌，吃两个撑得慌的情况。
